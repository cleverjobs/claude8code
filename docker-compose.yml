# ==============================================================================
# claude8code - Base Docker Compose Configuration
# ==============================================================================
# Anthropic-compatible API server powered by Claude Agent SDK
#
# Usage (standalone):
#   docker compose up -d
#   curl http://localhost:8787/health
#
# Usage (with extensions):
#   docker compose -f docker-compose.yml -f docker-compose.observability.yml up -d
#   docker compose -f docker-compose.yml -f docker-compose.mcp-example.yml up -d
# ==============================================================================

services:
  claude8code:
    build: .
    container_name: claude8code
    ports:
      - "8787:8787"
    volumes:
      # Mount workspace for file operations, skills, agents, commands, and MCP config
      - ./workspace:/home/claude8code/workspace
    environment:
      - CLAUDE8CODE_HOST=0.0.0.0
      - CLAUDE8CODE_PORT=8787
      - CLAUDE8CODE_CWD=/home/claude8code/workspace
      - CLAUDE8CODE_MAX_TURNS=10
      - CLAUDE8CODE_PERMISSION_MODE=acceptEdits
      # REQUIRED: OAuth token from `claude setup-token` (valid for 1 year)
      - CLAUDE_CODE_OAUTH_TOKEN=${CLAUDE_CODE_OAUTH_TOKEN:?CLAUDE_CODE_OAUTH_TOKEN is required - run 'claude setup-token' to get one}
      # Optional: API key authentication for the API server
      # - CLAUDE8CODE_AUTH_KEY=${CLAUDE8CODE_AUTH_KEY:-}
    restart: unless-stopped
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:8787/health"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 10s
